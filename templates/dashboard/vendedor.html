{% extends "base.html" %}
{% block content %}

<!-- HEADER -->
<section class="mb-8 bg-purple-600/40 backdrop-blur-md rounded-xl shadow-md py-6 flex flex-col items-center gap-2">
    <h1 class="text-3xl font-extrabold text-white flex items-center gap-2">
        <img src="{{ url_for('static', filename='icons/cog.svg') }}" alt="Gestión" class="w-7 h-7 filter invert">
        Gestión de Productos
    </h1>
    <p class="text-center text-purple-100 mt-1 flex items-center gap-2">
        <img src="{{ url_for('static', filename='icons/shield-user.svg') }}" alt="Inventario"
            class="w-5 h-5 filter invert">
        Controla tu inventario, stock y decisiones comerciales
    </p>
</section>

<!-- KPIs -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10">
    <div class="bg-black/40 border border-yellow-500 rounded-2xl shadow-lg p-5 text-center">
        <p class="text-gray-200 text-sm flex items-center justify-center gap-1">
            <img src="{{ url_for('static', filename='icons/productos.svg') }}" alt="Productos"
                class="w-4 h-4 filter invert">
            Productos Totales
        </p>
        <p class="text-3xl font-bold text-white">{{ productos|length }}</p>
    </div>

    <div class="bg-black/40 border border-yellow-500 rounded-2xl shadow-lg p-5 text-center">
        <p class="text-gray-200 text-sm flex items-center justify-center gap-1">
            <img src="{{ url_for('static', filename='icons/triangle-alert.svg') }}" alt="Stock bajo"
                class="w-4 h-4 filter invert">
            Stock Bajo
        </p>
        <p class="text-3xl font-bold text-red-400">
            {{ productos | selectattr("stock", "lt", 5) | list | length }}
        </p>
    </div>

    <div class="bg-black/40 border border-yellow-500 rounded-2xl shadow-lg p-5 text-center">
        <p class="text-gray-200 text-sm flex items-center justify-center gap-1">
            <img src="{{ url_for('static', filename='icons/badge-check.svg') }}" alt="Inventario activo"
                class="w-4 h-4 filter invert">
            Inventario Activo
        </p>
        <p class="text-3xl font-bold text-green-400">Operativo</p>
    </div>
</div>

<!-- CTA -->
<div class="flex justify-center mb-8">
    <a href="{{ url_for('productos.agregar_producto') }}" class="bg-purple-600/90 text-white px-6 py-3 rounded-xl
            hover:bg-purple-700 hover:scale-105 transition
            font-semibold shadow-lg flex items-center gap-2">
        <img src="{{ url_for('static', filename='icons/circle-plus.svg') }}" alt="Nuevo" class="w-5 h-5 filter invert">
        Nuevo Producto
    </a>
</div>

<!-- GRID DE PRODUCTOS -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

    {% for producto in productos %}
    <div
        class="bg-black/40 border border-yellow-500 rounded-2xl shadow-md hover:shadow-xl hover:scale-[1.02] transition transform flex flex-col overflow-hidden text-white">

        <!-- Imagen -->
        {% if producto.imagen %}
        <div class="h-48 bg-gray-800 flex items-center justify-center">
            <img src="{{ producto.imagen }}" class="object-contain max-h-full p-3 transition hover:scale-105">
        </div>
        {% else %}
        <div class="h-48 flex items-center justify-center bg-gray-700 text-gray-300 flex-col gap-2">
            <img src="{{ url_for('static', filename='icons/package-search.svg') }}" alt="Sin imagen"
                class="w-6 h-6 filter invert">
            Sin imagen
        </div>
        {% endif %}

        <!-- Info -->
        <div class="p-4 flex flex-col flex-1">
            <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                <img src="{{ url_for('static', filename='icons/productos.svg') }}" alt="Producto"
                    class="w-4 h-4 filter invert">
                {{ producto.nombre }}
            </h2>

            <p class="text-sm text-gray-200 mt-1 line-clamp-2">
                {{ producto.descripcion }}
            </p>

            <p class="mt-3 font-bold text-yellow-400 flex items-center gap-1">
                <img src="{{ url_for('static', filename='icons/dollar-sign.svg') }}" alt="Precio"
                    class="w-4 h-4 filter invert">
                ${{ producto.precio }}
            </p>

            <!-- Stock Badge -->
            {% if producto.stock < 5 %} <span
                class="mt-2 inline-block text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full w-fit flex items-center gap-1">
                <img src="{{ url_for('static', filename='icons/triangle-alert.svg') }}" alt="Crítico"
                    class="w-3 h-3 filter invert">
                Stock Crítico
                </span>
                {% elif producto.stock < 15 %} <span
                    class="mt-2 inline-block text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full w-fit">
                    Stock Medio
                    </span>
                    {% else %}
                    <span
                        class="mt-2 inline-block text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full w-fit flex items-center gap-1">
                        <img src="{{ url_for('static', filename='icons/badge-check.svg') }}" alt="Saludable"
                            class="w-3 h-3 filter invert">
                        Stock Saludable
                    </span>
                    {% endif %}

                    <p class="mt-2 text-sm text-gray-200 flex items-center gap-1">
                        <img src="{{ url_for('static', filename='icons/warehouse.svg') }}" alt="Stock"
                            class="w-4 h-4 filter invert">
                        Stock: <strong>{{ producto.stock }}</strong>
                    </p>

                    <!-- Agregar Stock -->
                    <form action="{{ url_for('productos.agregar_stock', id=producto.id) }}" method="POST"
                        class="flex gap-2 mt-4">
                        <input type="number" name="cantidad" min="1" placeholder="+ Stock"
                            class="w-full border border-yellow-500 bg-black/60 text-white rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-yellow-500 focus:outline-none"
                            required>
                        <button type="submit" class="bg-green-600 text-white px-4 rounded-lg
                     hover:bg-green-700 transition font-semibold flex items-center gap-1">
                            <img src="{{ url_for('static', filename='icons/layers-plus.svg') }}" alt="Agregar stock"
                                class="w-4 h-4 filter invert">
                            +
                        </button>
                    </form>

                    <!-- Acciones rápidas -->
                    <div class="flex gap-2 mt-4">
                        <a href="{{ url_for('productos.editar_producto', id=producto.id) }}"
                            class="flex-1 flex items-center justify-center gap-1 bg-purple-600/90 text-white py-2 rounded-lg hover:bg-purple-700 text-sm shadow transition">
                            <img src="{{ url_for('static', filename='icons/square-pen.svg') }}"
                                class="h-4 w-4 filter invert"> Editar
                        </a>
                        <form method="POST" action="{{ url_for('productos.eliminar_producto', id=producto.id) }}"
                            class="flex-1" onsubmit="return confirm('¿Eliminar este producto definitivamente?')">
                            <button
                                class="w-full flex items-center justify-center gap-1 bg-purple-600/90 text-white py-2 rounded-lg hover:bg-purple-700 text-sm shadow transition">
                                <img src="{{ url_for('static', filename='icons/trash.svg') }}"
                                    class="h-4 w-4 filter invert"> Eliminar
                            </button>
                        </form>
                    </div>
        </div>
    </div>
    {% endfor %}

</div>

{% endblock %}