{% extends "base.html" %}
{% block content %}

<div class="max-w-7xl mx-auto p-6 space-y-12">

    <!-- TÃ­tulo -->
    <section class="mb-8 bg-purple-600/40 backdrop-blur-md rounded-xl shadow-md py-6">
        <h1
            class="text-4xl font-extrabold text-white text-center tracking-tight flex items-center justify-center gap-3">
            <img src="{{ url_for('static', filename='icons/shield-user.svg') }}" class="h-8 w-8 filter invert"
                aria-hidden="true">
            Panel de AdministraciÃ³n
        </h1>
        <p class="text-center text-purple-100 mt-1">Control total de usuarios y productos</p>
    </section>

    <!-- KPIs -->
    <div class="grid grid-cols-1 sm:grid-cols-4 gap-6">
        <div class="bg-black/40 border border-yellow-500 p-6 rounded-2xl shadow hover:scale-[1.02] transition">
            <p class="flex items-center gap-2 text-gray-200 text-sm">
                <img src="{{ url_for('static', filename='icons/users-round.svg') }}" class="h-5 w-5 filter invert">
                Usuarios totales
            </p>
            <p class="text-4xl font-extrabold text-yellow-400 mt-2">{{ usuarios|length }}</p>
        </div>
        <div class="bg-black/40 border border-yellow-500 p-6 rounded-2xl shadow hover:scale-[1.02] transition">
            <p class="flex items-center gap-2 text-gray-200 text-sm">
                <img src="{{ url_for('static', filename='icons/productos.svg') }}" class="h-5 w-5 filter invert">
                Productos activos
            </p>
            <p class="text-4xl font-extrabold text-yellow-400 mt-2">{{ productos|length }}</p>
        </div>
        <div class="bg-black/40 border border-yellow-500 p-6 rounded-2xl shadow hover:scale-[1.02] transition">
            <p class="flex items-center gap-2 text-gray-200 text-sm">
                <img src="{{ url_for('static', filename='icons/warehouse.svg') }}" class="h-5 w-5 filter invert"> Stock
                total
            </p>
            <p class="text-4xl font-extrabold text-yellow-400 mt-2">{{ productos | sum(attribute='stock') }}</p>
        </div>
        <div class="bg-black/40 border border-yellow-500 p-6 rounded-2xl shadow hover:scale-[1.02] transition">
            <p class="flex items-center gap-2 text-gray-200 text-sm">
                <img src="{{ url_for('static', filename='icons/circle-dollar-sign.svg') }}"
                    class="h-5 w-5 filter invert"> Valor inventario
            </p>
            <p class="text-4xl font-extrabold text-yellow-400 mt-2">${{ productos | sum(attribute='precio') }}</p>
        </div>
    </div>

    <!-- GestiÃ³n de Usuarios -->
    <section>
        <h2 class="text-2xl font-bold mb-6 text-white flex items-center gap-2">
            <img src="{{ url_for('static', filename='icons/users-round.svg') }}" class="h-6 w-6 filter invert"> GestiÃ³n
            de Usuarios
        </h2>

        <div class="space-y-4">
            {% for user in usuarios %}
            <div
                class="bg-black/40 border border-yellow-500 p-5 rounded-2xl shadow-md hover:shadow-lg hover:scale-[1.01] transition flex flex-col md:flex-row md:items-center md:justify-between gap-4">

                <!-- Info usuario -->
                <div>
                    <p class="font-semibold text-white">{{ user.nombre }}</p>
                    <p class="text-sm text-gray-200">{{ user.email }}</p>
                    <span class="inline-block mt-1 text-xs font-semibold px-2 py-1 rounded-full
                       {% if user.rol == 'admin' %} bg-red-100 text-red-700
                       {% elif user.rol == 'vendedor' %} bg-blue-100 text-blue-700
                       {% elif user.rol == 'cliente' %} bg-green-100 text-green-700
                       {% elif user.rol == 'bloqueado' %} bg-gray-200 text-gray-700
                       {% else %} bg-purple-100 text-purple-700 {% endif %}">
                        {{ user.rol }}
                    </span>
                </div>

                <!-- Acciones rÃ¡pidas -->
                <div class="flex flex-wrap gap-3">
                    <!-- Cambiar rol -->
                    <form action="{{ url_for('dashboard.cambiar_rol', user_id=user.id) }}" method="post"
                        class="flex items-center gap-2">
                        <select name="rol"
                            class="border rounded-lg px-2 py-1 text-sm focus:ring-2 focus:ring-yellow-500 bg-black/60 text-white">
                            <option value="cliente" {% if user.rol=="cliente" %}selected{% endif %}>Cliente</option>
                            <option value="vendedor" {% if user.rol=="vendedor" %}selected{% endif %}>Vendedor</option>
                            <option value="admin" {% if user.rol=="admin" %}selected{% endif %}>Admin</option>
                        </select>
                        <button
                            class="flex items-center gap-1 bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700 text-sm shadow">
                            <img src="{{ url_for('static', filename='icons/square-pen.svg') }}"
                                class="h-4 w-4 filter invert"> Cambiar rol
                        </button>
                    </form>

                    <!-- Bloquear / desbloquear -->
                    <form action="{{ url_for('dashboard.toggle_usuario', user_id=user.id) }}" method="post">
                        <button
                            class="flex items-center gap-1 bg-red-600 text-white px-3 py-1 rounded-lg hover:bg-red-700 text-sm shadow">
                            <img src="{{ url_for('static', filename='icons/triangle-alert.svg') }}"
                                class="h-4 w-4 filter invert">
                            {% if user.rol == "bloqueado" %}Desbloquear{% else %}Bloquear{% endif %}
                        </button>
                    </form>
                </div>

            </div>
            {% endfor %}
        </div>
    </section>

    <!-- GestiÃ³n de Productos -->
    <section>
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                <img src="{{ url_for('static', filename='icons/productos.svg') }}" class="h-6 w-6 filter invert">
                GestiÃ³n de Productos
            </h2>
            <a href="{{ url_for('productos.agregar_producto') }}"
                class="flex items-center gap-1 bg-purple-600/90 text-white px-5 py-2 rounded-xl font-semibold hover:bg-purple-700 shadow transition">
                <img src="{{ url_for('static', filename='icons/circle-plus.svg') }}" class="h-5 w-5 filter invert">
                Nuevo producto
            </a>
        </div>

        <!-- Grid de productos -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {% for producto in productos %}
            <div
                class="bg-black/40 border border-yellow-500 p-5 rounded-2xl shadow-md hover:shadow-xl hover:scale-[1.02] transition transform flex flex-col">

                <!-- Imagen -->
                {% if producto.imagen %}
                <div class="h-40 flex items-center justify-center bg-gray-800 rounded-xl mb-4 overflow-hidden">
                    <img src="{{ producto.imagen }}"
                        class="max-h-full max-w-full object-contain transition hover:scale-105">
                </div>
                {% else %}
                <div class="h-40 flex items-center justify-center bg-gray-700 text-gray-400 rounded-xl mb-4">
                    <img src="{{ url_for('static', filename='icons/package-search.svg') }}"
                        class="h-6 w-6 filter invert"> Sin imagen
                </div>
                {% endif %}

                <!-- Info -->
                <h3 class="text-lg font-bold text-white">{{ producto.nombre }}</h3>
                <p class="text-gray-200 text-sm flex-1 mt-1">{{ producto.descripcion }}</p>



                <!-- Precio y stock -->
                <div class="mt-3 text-sm space-y-1">
                    <p class="flex items-center gap-2 text-gray-200">
                        <img src="{{ url_for('static', filename='icons/circle-dollar-sign.svg') }}" alt="Precio"
                            class="h-4 w-4 filter invert">
                        <span class="font-semibold">Precio:</span> ${{ producto.precio }}
                    </p>
                    <p class="flex items-center gap-2 text-gray-200">
                        <img src="{{ url_for('static', filename='icons/warehouse.svg') }}" alt="Stock"
                            class="h-4 w-4 filter invert">
                        <span class="font-semibold">Stock:</span> {{ producto.stock }}
                    </p>

                    <!-- Badge de stock -->
                    {% if producto.stock < 5 %} <span
                        class="inline-block mt-2 text-xs font-semibold px-2 py-1 rounded-full bg-red-100 text-red-700">
                        âš  Stock bajo
                        </span>
                        {% elif producto.precio > 1000 %}
                        <span
                            class="inline-block mt-2 text-xs font-semibold px-2 py-1 rounded-full bg-yellow-100 text-yellow-700">
                            ðŸ’Ž Premium
                        </span>
                        {% else %}
                        <span
                            class="inline-block mt-2 text-xs font-semibold px-2 py-1 rounded-full bg-green-100 text-green-700">
                            âœ” Disponible
                        </span>
                        {% endif %}
                </div>

                <!-- Acciones rÃ¡pidas -->
                <div class="flex gap-2 mt-4">
                    <a href="{{ url_for('productos.editar_producto', id=producto.id) }}"
                        class="flex-1 flex items-center justify-center gap-1 bg-purple-600/90 text-white py-2 rounded-lg hover:bg-purple-700 text-sm shadow transition">
                        <img src="{{ url_for('static', filename='icons/square-pen.svg') }}"
                            class="h-4 w-4 filter invert"> Editar
                    </a>
                    <form method="POST" action="{{ url_for('productos.eliminar_producto', id=producto.id) }}"
                        class="flex-1" onsubmit="return confirm('Â¿Eliminar este producto definitivamente?')">
                        <button
                            class="w-full flex items-center justify-center gap-1 bg-purple-600/90 text-white py-2 rounded-lg hover:bg-purple-700 text-sm shadow transition">
                            <img src="{{ url_for('static', filename='icons/trash.svg') }}"
                                class="h-4 w-4 filter invert"> Eliminar
                        </button>
                    </form>
                </div>

            </div>
            {% endfor %}
        </div>
    </section>

    {% endblock %}