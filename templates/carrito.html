{% extends "base.html" %}
{% block content %}

<!-- Encabezado -->
<div class="bg-purple-600/40 backdrop-blur-md rounded-xl shadow-md py-6 mb-10 flex items-center justify-center gap-2">
  <h1 class="text-3xl font-bold text-white text-center">
    Confirmar Compra
  </h1>
</div>

{% if items %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

  <!-- LISTA DE PRODUCTOS -->
  <div class="lg:col-span-2 space-y-4">
    {% for item in items %}
    <div class="flex gap-4 p-4 bg-white/90 rounded-2xl shadow-md hover:shadow-lg hover:scale-[1.01] transition transform">

      <!-- Imagen -->
      {% if item.producto.imagen %}
      <div class="w-24 h-24 flex items-center justify-center bg-gray-100 rounded-xl overflow-hidden">
        <img src="{{ item.producto.imagen }}" class="max-h-full max-w-full object-contain">
      </div>
      {% endif %}

      <!-- Info -->
      <div class="flex-1">
        <h2 class="font-semibold text-gray-800 flex items-center gap-2">
          <img src="{{ url_for('static', filename='icons/productos.svg') }}" alt="Producto" class="w-4 h-4">
          {{ item.producto.nombre }}
        </h2>
        <p class="text-sm text-gray-500 flex items-center gap-1">
          <img src="{{ url_for('static', filename='icons/dollar-sign.svg') }}" alt="Precio" class="w-3 h-3">
          Precio unitario: {{ item.producto.precio|clp }}
        </p>

        <p class="text-sm text-gray-600 flex items-center gap-1 mt-1">
          <img src="{{ url_for('static', filename='icons/warehouse.svg') }}" alt="Cantidad" class="w-3 h-3">
          Cantidad: {{ item.cantidad }}
        </p>
      </div>

      <!-- Subtotal -->
      <div class="flex items-center font-bold text-gray-900 gap-1">
        <img src="{{ url_for('static', filename='icons/circle-dollar-sign.svg') }}" alt="Subtotal" class="w-4 h-4">
        {{ (item.producto.precio * item.cantidad)|clp }}
      </div>

    </div>
    {% endfor %}
  </div>

  <!-- RESUMEN -->
  <div class="bg-white/90 rounded-2xl shadow-lg p-6 h-fit sticky top-24">
    <h3 class="text-xl font-bold mb-4 text-purple-700 flex items-center gap-2">
      <img src="{{ url_for('static', filename='icons/banknote.svg') }}" alt="Resumen" class="w-5 h-5">
      Resumen de compra
    </h3>

    <div class="flex justify-between text-gray-700 mb-2">
      <span>Productos</span>
      <span>{{ items|length }}</span>
    </div>

    <div class="flex justify-between font-bold text-lg text-gray-900 border-t pt-4 mt-4">
      <span>Total a pagar</span>
      <span>{{ total|clp }}</span>
    </div>

    <form method="POST" action="{{ url_for('productos.checkout') }}">
      <button type="submit"
              class="mt-6 w-full text-center bg-purple-600/90 text-white py-3 rounded-xl
                     font-semibold shadow-md hover:bg-purple-700 hover:scale-105
                     transform transition flex items-center justify-center gap-2">
        <img src="{{ url_for('static', filename='icons/badge-check.svg') }}" alt="Finalizar" class="w-5 h-5">
        Confirmar compra
      </button>
    </form>
  </div>

</div>

{% else %}

<!-- CARRITO VACÍO -->
<div class="text-center mt-20 text-gray-600">
  <img src="{{ url_for('static', filename='icons/cart (2).svg') }}" 
       class="w-16 h-16 mx-auto mb-4 filter brightness-0 invert">
  <p class="text-xl mb-4">Tu carrito está vacío</p>
  <a href="{{ url_for('productos.listar_productos') }}"
     class="inline-block bg-purple-600/90 text-white px-6 py-3 rounded-xl
            hover:bg-purple-700 transition shadow-md flex items-center gap-2 justify-center">
    <img src="{{ url_for('static', filename='icons/package-search.svg') }}" 
         alt="Ver productos" class="w-5 h-5">
    Ver productos
  </a>
</div>

{% endif %}

{% endblock %}